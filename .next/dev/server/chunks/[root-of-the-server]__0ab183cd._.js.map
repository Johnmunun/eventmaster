{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\n// Empêche Prisma d'être chargé dans le runtime edge\nif (typeof window !== \"undefined\") {\n  throw new Error(\"❌ Prisma ne peut pas être utilisé dans le frontend.\");\n}\n\nif (process.env.NEXT_RUNTIME === \"edge\") {\n  throw new Error(\"❌ Prisma ne peut pas être utilisé dans le runtime Edge.\");\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log:\n      process.env.NODE_ENV === 'development'\n        ? ['error', 'warn']\n        : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = db;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIxB,oDAAoD;AACpD;;AAIA;;AAIO,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KACE,uCACI;QAAC;QAAS;KAAO,GACjB;AACR;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\nimport { PrismaAdapter } from \"@auth/prisma-adapter\"\nimport Credentials from \"next-auth/providers/credentials\"\nimport Google from \"next-auth/providers/google\"\nimport { db } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\nimport dotenv from \"dotenv\"\n\n// Charger les variables d'environnement\ndotenv.config({ path: '.env' })\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  adapter: PrismaAdapter(db) as any,\n  providers: [\n    Credentials({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Email et mot de passe requis\")\n        }\n\n        const user = await db.user.findUnique({\n          where: {\n            email: credentials.email as string\n          }\n        })\n\n        if (!user || !user.password) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password as string,\n          user.password\n        )\n\n        if (!isPasswordValid) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          image: user.image,\n          role: user.role,\n        }\n      }\n    }),\n    Google({\n      clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n    })\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  pages: {\n    signIn: \"/login\",\n    signOut: \"/\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id\n        token.role = (user as any).role\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string\n        session.user.role = token.role as string\n      }\n      return session\n    },\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  trustHost: true, // Nécessaire pour Next.js 16\n})\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;AAEA,wCAAwC;AACxC,kJAAM,CAAC,MAAM,CAAC;IAAE,MAAM;AAAO;AAEtB,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,kKAAQ,EAAC;IAC1D,SAAS,IAAA,uKAAa,EAAC,iHAAE;IACzB,WAAW;QACT,IAAA,uMAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;oBACpC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,MAAM,IAAI,MAAM;gBAClB;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;QACA,IAAA,kMAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACpD;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;QACR,SAAS;IACX;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI;YACjC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,WAAW;AACb"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/app/api/user/profile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { auth } from \"@/lib/auth\"\r\nimport { db } from \"@/lib/db\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Vérifier l'authentification\r\n    const session = await auth()\r\n    \r\n    if (!session?.user?.id) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Non authentifié\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const userId = session.user.id\r\n\r\n    // Récupérer uniquement les champs nécessaires\r\n    const user = await db.user.findUnique({\r\n      where: { id: userId },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        image: true,\r\n        credits: true,\r\n        role: true,\r\n        plan: true,\r\n        createdAt: true,\r\n      }\r\n    })\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Utilisateur non trouvé\" },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    // Générer les initiales pour l'avatar\r\n    const initials = user.name\r\n      ? user.name\r\n          .split(\" \")\r\n          .map(n => n[0])\r\n          .join(\"\")\r\n          .toUpperCase()\r\n          .slice(0, 2)\r\n      : user.email[0].toUpperCase()\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: {\r\n        ...user,\r\n        initials,\r\n      }\r\n    }, { status: 200 })\r\n\r\n  } catch (error) {\r\n    console.error(\"Erreur lors de la récupération du profil:\", error)\r\n    return NextResponse.json(\r\n      { success: false, error: \"Une erreur est survenue\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,8BAA8B;QAC9B,MAAM,UAAU,MAAM,IAAA,qHAAI;QAE1B,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAkB,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;QAE9B,8CAA8C;QAC9C,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,IAAI;YAAO;YACpB,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,OAAO;gBACP,SAAS;gBACT,MAAM;gBACN,MAAM;gBACN,WAAW;YACb;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAyB,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,sCAAsC;QACtC,MAAM,WAAW,KAAK,IAAI,GACtB,KAAK,IAAI,CACN,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,IAAK,CAAC,CAAC,EAAE,EACb,IAAI,CAAC,IACL,WAAW,GACX,KAAK,CAAC,GAAG,KACZ,KAAK,KAAK,CAAC,EAAE,CAAC,WAAW;QAE7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,GAAG,IAAI;gBACP;YACF;QACF,GAAG;YAAE,QAAQ;QAAI;IAEnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA0B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}