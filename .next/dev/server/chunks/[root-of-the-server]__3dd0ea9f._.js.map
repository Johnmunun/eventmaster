{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\n// Empêche Prisma d'être chargé dans le runtime edge\nif (typeof window !== \"undefined\") {\n  throw new Error(\"❌ Prisma ne peut pas être utilisé dans le frontend.\");\n}\n\nif (process.env.NEXT_RUNTIME === \"edge\") {\n  throw new Error(\"❌ Prisma ne peut pas être utilisé dans le runtime Edge.\");\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log:\n      process.env.NODE_ENV === 'development'\n        ? ['error', 'warn']\n        : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = db;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIxB,oDAAoD;AACpD;;AAIA;;AAIO,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KACE,uCACI;QAAC;QAAS;KAAO,GACjB;AACR;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\nimport { PrismaAdapter } from \"@auth/prisma-adapter\"\nimport Credentials from \"next-auth/providers/credentials\"\nimport Google from \"next-auth/providers/google\"\nimport { db } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\nimport dotenv from \"dotenv\"\n\n// Charger les variables d'environnement\ndotenv.config({ path: '.env' })\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  adapter: PrismaAdapter(db) as any,\n  providers: [\n    Credentials({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Email et mot de passe requis\")\n        }\n\n        const user = await db.user.findUnique({\n          where: {\n            email: credentials.email as string\n          }\n        })\n\n        if (!user || !user.password) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password as string,\n          user.password\n        )\n\n        if (!isPasswordValid) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          image: user.image,\n          role: user.role,\n        }\n      }\n    }),\n    Google({\n      clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n    })\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  pages: {\n    signIn: \"/login\",\n    signOut: \"/\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id\n        token.role = (user as any).role\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string\n        session.user.role = token.role as string\n      }\n      return session\n    },\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  trustHost: true, // Nécessaire pour Next.js 16\n})\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;AAEA,wCAAwC;AACxC,kJAAM,CAAC,MAAM,CAAC;IAAE,MAAM;AAAO;AAEtB,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,kKAAQ,EAAC;IAC1D,SAAS,IAAA,uKAAa,EAAC,iHAAE;IACzB,WAAW;QACT,IAAA,uMAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;oBACpC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,MAAM,IAAI,MAAM;gBAClB;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;QACA,IAAA,kMAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACpD;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;QACR,SAAS;IACX;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI;YACjC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,WAAW;AACb"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///H:/React_projets/EventMaster/app/api/folders/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { auth } from \"@/lib/auth\"\r\nimport { db } from \"@/lib/db\"\r\nimport { z } from \"zod\"\r\nimport { Prisma } from \"@prisma/client\"\r\n\r\nconst createFolderSchema = z.object({\r\n  name: z.string().min(1, \"Le nom est requis\").max(50, \"Le nom est trop long\"),\r\n  color: z.string().min(1, \"La couleur est requise\"),\r\n})\r\n\r\n// POST - Créer un dossier\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const session = await auth()\r\n    \r\n    if (!session?.user?.id) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Non authentifié\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const userId = session.user.id\r\n\r\n    // Parser le body\r\n    let body\r\n    try {\r\n      body = await request.json()\r\n    } catch (parseError) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Format de requête invalide\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Validation\r\n    const validatedData = createFolderSchema.parse(body)\r\n\r\n    // Créer le dossier\r\n    const folder = await db.folder.create({\r\n      data: {\r\n        name: validatedData.name.trim(),\r\n        color: validatedData.color,\r\n        userId: userId,\r\n      },\r\n      include: {\r\n        _count: {\r\n          select: {\r\n            qrCodes: true,\r\n          }\r\n        }\r\n      }\r\n    })\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Dossier créé avec succès\",\r\n      folder: {\r\n        id: folder.id,\r\n        name: folder.name,\r\n        color: folder.color,\r\n        count: folder._count.qrCodes,\r\n        createdAt: folder.createdAt.toISOString(),\r\n      }\r\n    }, { status: 201 })\r\n\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: error.errors[0].message,\r\n          details: error.errors \r\n        },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (error instanceof Prisma.PrismaClientKnownRequestError) {\r\n      if (error.code === 'P1001') {\r\n        return NextResponse.json(\r\n          { success: false, error: \"Impossible de se connecter à la base de données\" },\r\n          { status: 503 }\r\n        )\r\n      }\r\n    }\r\n\r\n    console.error(\"Erreur lors de la création du dossier:\", error)\r\n    return NextResponse.json(\r\n      { success: false, error: \"Une erreur est survenue lors de la création du dossier\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// GET - Récupérer les dossiers de l'utilisateur\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const session = await auth()\r\n    \r\n    if (!session?.user?.id) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Non authentifié\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const userId = session.user.id\r\n\r\n    const folders = await db.folder.findMany({\r\n      where: {\r\n        userId,\r\n      },\r\n      include: {\r\n        _count: {\r\n          select: {\r\n            qrCodes: true,\r\n          }\r\n        }\r\n      },\r\n      orderBy: {\r\n        createdAt: 'desc'\r\n      }\r\n    })\r\n\r\n    const formattedFolders = folders.map(folder => ({\r\n      id: folder.id,\r\n      name: folder.name,\r\n      color: folder.color,\r\n      count: folder._count.qrCodes,\r\n      createdAt: folder.createdAt.toISOString(),\r\n    }))\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      folders: formattedFolders\r\n    }, { status: 200 })\r\n\r\n  } catch (error) {\r\n    console.error(\"Erreur lors de la récupération des dossiers:\", error)\r\n    return NextResponse.json(\r\n      { success: false, error: \"Une erreur est survenue\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}